[phases.setup]
nixPkgs = ['php82', 'php82Extensions.pdo', 'php82Extensions.pdo_mysql']

[phases.install]
cmds = ['composer install --no-dev --optimize-autoloader']

[phases.build]
# Avoid artisan commands that might trigger DB connections during build
cmds = ['chmod -R 777 storage bootstrap/cache']

[start]
# Run migrations and start the server only when the container is RUNNING (DB is accessible then)
cmd = 'php artisan migrate --force && php artisan optimize && php artisan serve --host=0.0.0.0 --port=$PORT'
